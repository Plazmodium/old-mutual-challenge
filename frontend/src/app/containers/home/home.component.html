<div class="container mx-auto p-4">
  <h1 class="text-2xl font-bold mb-4">Countries</h1>

  <!-- Filters and Sorting -->
  <div class="flex flex-wrap gap-4 mb-6">
    <div class="flex flex-col">
      <label for="region" class="text-sm font-medium mb-1">Filter by Region</label>
      <select id="region"
              [ngModel]="selectedRegion()"
              (ngModelChange)="onRegionChange($event)"
              class="border rounded p-2">
        <option value="">All Regions</option>
        @for (region of regions; track region) {
          <option [value]="region">{{ region }}</option>
        }
      </select>
    </div>

    <div class="flex flex-col">
      <label for="sort" class="text-sm font-medium mb-1">Sort by</label>
      <select id="sort"
              [ngModel]="sortBy()"
              (ngModelChange)="onSortChange($event)"
              class="border rounded p-2">
        <option value="commonName,asc">Name (A-Z)</option>
        <option value="commonName,desc">Name (Z-A)</option>
        <option value="population,desc">Population (High-Low)</option>
        <option value="population,asc">Population (Low-High)</option>
      </select>
    </div>
  </div>

  <!-- Flags Payload -->
  @if (isLoading()) {
    <p>Loading...</p>
  } @else if (error()) {
    <p class="text-red-500">{{ error() }}</p>
  } @else if (countries().length === 0) {
    <p>No countries found.</p>
  } @else {
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
      @for (country of countries(); track country.cca3) {
        <app-country-card [country]="country" />
      }
    </div>

    <!-- Pagination -->
    <div class="flex items-center justify-center gap-4 mt-8">
      <button (click)="onPageChange(currentPage() - 1)"
              [disabled]="currentPage() === 0"
              class="px-4 py-2 border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100">
        Previous
      </button>

      <span class="text-sm">
        Page {{ currentPage() + 1 }} of {{ totalPages() }}
        ({{ totalElements() }} total countries)
      </span>

      <button (click)="onPageChange(currentPage() + 1)"
              [disabled]="currentPage() === totalPages() - 1"
              class="px-4 py-2 border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100">
        Next
      </button>
    </div>
  }
</div>
